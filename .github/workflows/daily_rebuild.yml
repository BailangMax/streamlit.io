name: Streamlit Daily Rebuild with Notification

on:
  schedule:
    # 北京时间每日凌晨 3:00 (即 UTC 19:00)
    - cron: '0 19 * * *'
  
  # 允许您手动在 Actions 标签页触发此工作流
  workflow_dispatch:

jobs:
  rebuild:
    runs-on: ubuntu-latest

    # vvvvvv 请在这里添加下面 2 行 vvvvvv
    permissions:
      contents: write
    # ^^^^^^ 上面 2 行是新添加的 ^^^^^^

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # 建议使用 @v4 (最新版)

      - name: Set up Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Create empty commit and push
        run: |
          git commit --allow-empty -m "Trigger daily rebuild"
          git push

      - name: Send Telegram notification on success
        if: success()
        uses: appleboy/telegram-action@master
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_TO }}
          message: |
            ✅ Streamlit 应用重建任务成功！
            
            应用链接: https://axxsxx.streamlit.app/
            触发时间: 北京时间 03:00

      - name: Send Telegram notification on failure
        if: failure()
        uses: appleboy/telegram-action@master
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_TO }}
          message: |
            ❌ Streamlit 应用重建任务失败！
            
            请检查 GitHub Actions 日志获取详情。
